<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <title>Kontrollplan PDF</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 10mm 8mm 12mm 8mm; color:#202124; }
    h2 { text-align:center; margin:0 0 8px 0; }
    .grid { display:grid; grid-template-columns: repeat(3, 1fr); gap: 6px 16px; font-size: 11px; }
    .meta { border:1px solid #ddd; border-radius:8px; padding:8px; }
    p.legend { font-size: 10px; color:#555; margin: 6px 0 0 0; }
    table { width:100%; border-collapse:collapse; font-size: 10px; table-layout: fixed; }
    th, td { border:1px solid #ddd; padding:6px 8px; text-align:left; vertical-align: top; word-wrap:break-word; }
    th { background:#eef2f7; }
    tr.category td { background:#e8f1ff; font-weight:bold; }
    .attest { margin-top: 14px; font-size: 11px; }
    .line { display:inline-block; border-bottom: 1px solid #000; height: 18px; min-width: 240px; margin-left: 8px; }
    .attest-row { margin: 8px 0; }
    footer { margin-top: 10px; font-size: 10px; color:#666; }
  </style>
</head>
<body>
  <h2>Kontrollplan – {{ bygglov_typ }}</h2>
  <div class="meta grid">
    <div><strong>Kommun:</strong> {{ kommun }}</div>
    <div><strong>BH:</strong> {{ byggherre }}</div>
    <div><strong>Personnummer:</strong> {{ personnummer }}</div>
    <div><strong>Kontakt:</strong> {{ kontakt }}</div>
    <div><strong>Fastighetsbeteckning:</strong> {{ fastighet }}</div>
    <div><strong>Adress:</strong> {{ adress }}</div>
    <div><strong>KA:</strong> {{ ka_namn }} {% if ka_tel %} – {{ ka_tel }}{% endif %}{% if ka_epost %} – {{ ka_epost }}{% endif %}</div>
  </div>
  <p class="legend"><strong>Förkortningar:</strong> BH = Byggherre, KA = Kontrollansvarig</p>

  <table>
    <thead>
      <tr>
        <th style="width: 22%;">Kategori / Kontrollpunkt</th>
        <th style="width: 13%;">Vem</th>
        <th style="width: 18%;">Hur</th>
        <th style="width: 23%;">Kontrolleras mot</th>
        <th style="width: 12%;">När</th>
        <th style="width: 12%;">Signatur / Datum</th>
        <th style="width: 12%;">Till kommunen</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
        {% if r.is_category %}
          <tr class="category"><td colspan="7">{{ r.kategori }}</td></tr>
        {% else %}
          <tr>
            <td>{{ r.kontrollpunkt }}</td>
            <td>{{ r.vem }}</td>
            <td>{{ r.hur }}</td>
            <td>{{ r.mot }}</td>
            <td>{{ r.nar }}</td>
            <td>{{ r.signatur }}</td>
            <td>{{ r.till_kommun }}</td>
          </tr>
        {% endif %}
      {% endfor %}
    </tbody>
  </table>

  <div class="attest">
    <strong>Härmed intygas att kontrollpunkterna har utförts och samtliga angivna krav har uppfyllts</strong>
    <div class="attest-row"><span><strong>Datum:</strong></span><span class="line"></span></div>
    <div class="attest-row"><span><strong>Namnteckning:</strong></span><span class="line"></span></div>
    <div class="attest-row"><span><strong>Namnförtydligande:</strong></span><span class="line"></span></div>
  </div>

  <footer>Kontrollplan enligt PBL. Enkel version för privatpersoner.</footer>
</body>
</html>
